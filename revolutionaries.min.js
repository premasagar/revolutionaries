"use strict";
/*
* The Revolutionaries
*   dharmfly.com/revolutionaries
*   github.com/premasagar/revolutionaries
*
*/
var revolutionaries=(function(){var v=250,w=[],H=-1,D=this,q=D.jQuery,l,c,M;M=D._=(function(){var R=this,Q=R.navigator.userAgent,P=R.console,N=R.opera,O;if(!P){return(N&&N.postError)?function(){var V,T,W=N.postError,U=arguments,S,X,Z;W(U);T=U.length;for(V=0;V<T;V++){S=U[V];if(typeof S==="object"&&S!==null){X=[];for(Z in S){try{if(S.hasOwnProperty(Z)){X.push(Z+": "+S[Z])}}catch(Y){}}W("----subArgs: "+X)}}}:function(){}}else{if(/webkit/i.test(Q)){return function(){var V,T,U=arguments,S="";T=U.length;for(V=0;V<T;V++){if(typeof U[V]==="object"&&JSON&&JSON.stringify){U[V]=JSON.stringify(U[V])}P.log(S+U[V]);S="---- "}}}else{O=P.debug;return O?O:function(){var V,T,W=P.log,U=arguments,S="";if(W){if(typeof W.apply==="function"){W.apply(P,U)}else{T=U.length;for(V=0;V<T;V++){W(S+U[V]);S="---- "}}}}}}}());function i(O,Q){var P="revolutionaries",N,S;try{N=D.localStorage;S=D.JSON;if(!N||!S){return false}O=P+"."+O;if(typeof Q==="undefined"){Q=N[O];return Q?S.parse(Q).v:Q}else{N[O]=S.stringify({v:Q,t:new Date().getTime()})}}catch(R){M("localStorage error: ",R);return false}}function h(N,P){var O=i(N);if(O){P(O)}else{q.getJSON(N,function(Q){i(N,Q);P(Q)})}}function A(N){return"http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(N)+"&format=json&callback=?"}function K(P,R,N){var O=A(P),Q=N?h:q.getJSON;Q.call(null,O,function(S){R(S&&S.query&&S.query.results?S.query.results:{})})}function E(N){return"http://dbpedia.org/sparql?query="+encodeURIComponent(N)+"&format=json"}function b(N){return"select results from json where url='"+E(N)+"'"}function L(N){return A('select * from query.multi where queries="'+N.join(";")+'"')}function y(N,P){var O=b(N);K(O,function(Q){P(Q&&Q.json&&Q.json.results&&Q.json.results.bindings?Q.json.results.bindings:Q)},true)}function m(N,P){var O="select url from search.web where query=\"site:en.wikipedia.org/wiki/ '"+N+"'\" LIMIT 1";K(O,function(Q){P(Q?Q.result.url:false)},true)}function a(O){var P="http://dbpedia.org/resource/",N="http://en.wikipedia.org/wiki/";O=q.trim(O);if(O.indexOf(N)===0){return O.replace(N,P)}return P+O}function t(O){var P="http://dbpedia.org/resource/",N="http://en.wikipedia.org/wiki/";O=q.trim(O);if(O.indexOf(P)===0){return O.replace(P,N)}return N+O}function G(N){return q.trim(N).replace(/^.*\/(.*)\/?$/,"$1")}function g(N){return N.toLowerCase().replace(/[_ ]/g,"-").replace(/[^a-z\-]/g,"")}function k(N){return g(G(N))}function F(N){return N.replace("/en/","/commons/")}function C(O,N){return O.replace(/\d+px/,N+"px")}function s(N){return N.replace(/ \([^\)]*\)/,"")}function u(P,O,Q){if(P){var N;N=q('<img class="photo" src="'+P+'" alt="'+(O||"")+'">')[0];N.onload=function(){Q.call(this,true)};N.onerror=function(){Q.call(this,false)}}}function j(O,P){var N=100;return y("PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> PREFIX foaf: <http://xmlns.com/foaf/0.1/> SELECT ?name, ?depiction, ?thumbnail, ?influences, ?abstract WHERE { <"+O+'> rdfs:label ?name; foaf:depiction ?depiction ; <http://dbpedia.org/ontology/thumbnail> ?thumbnail; <http://dbpedia.org/ontology/abstract> ?abstract. FILTER langMatches( lang(?name), "EN" ) . FILTER langMatches( lang(?abstract), "EN" ) . }',function(Q){P({type:"person-detail",id:k(O),url:t(O),dbUrl:O,name:Q.name?s(Q.name.value):"",depiction:Q.depiction?Q.depiction.value:"",thumbnail:Q.thumbnail?C(Q.thumbnail.value,N):"",desc:Q["abstract"]?Q["abstract"].value:""})})}function e(O,P,N){return y("PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> PREFIX foaf: <http://xmlns.com/foaf/0.1/> SELECT ?influenced, ?name WHERE { ?influenced <http://dbpedia.org/property/influenced> <"+O+'> . OPTIONAL { ?influenced foaf:name ?name . } FILTER langMatches( lang(?name), "EN" ) . }',function(Q){var R={};Q=q.map(Q,function(U,T){var S=U.influenced.value;if(!R[S]){R[S]=true;return U}});q.each(Q,function(S,T){Q[S]={type:"person-summary",dbUrl:T.influenced.value,url:t(T.influenced.value),id:k(T.influenced.value),name:T.name?s(T.name.value):"",depiction:T.depiction?T.depiction.value:"",thumbnail:T.thumbnail?T.thumbnail.value:"",desc:T["abstract"]?T["abstract"].value:""}});P(Q)})}function n(N,O){return y("PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> PREFIX foaf: <http://xmlns.com/foaf/0.1/> SELECT DISTINCT ?influence, ?name WHERE { ?influence <http://dbpedia.org/property/influences> <"+N+'> . OPTIONAL { ?influence foaf:name ?name . } FILTER langMatches( lang(?name), "EN" ) . }',function(P){var Q={};P=q.map(P,function(T,S){var R=T.influence.value;if(!Q[R]){Q[R]=true;return T}});q.each(P,function(R,S){P[R]={type:"person-summary",dbUrl:S.influence.value,url:t(S.influence.value),id:k(S.influence.value),name:S.name?s(S.name.value):"",depiction:S.depiction?S.depiction.value:"",thumbnail:S.thumbnail?S.thumbnail.value:"",desc:S["abstract"]?S["abstract"].value:""}});O(P)})}function I(O,R,Q){R=R||0;var S="@@R@E@V@O~L~U~T~I~O@N@A@R@Y@",P=q.trim(O).replace(/(\w\w\w)\.\s+/g,"$1."+S).split(S),N=P.length;P[N-1].replace(/(?!\.)$/,".");Q=typeof Q==="number"?Q:N;return P.slice(R,Q)}function p(N,P,O){if(typeof N==="string"){return p(I(N,P,O))}else{return N.join(" ")}}function J(N){q(D).trigger("slugchange",N)}function B(N){if(q.isArray(N)){return w}if(typeof N!=="number"){N=H}return N===-1?w[w.length-1]:w[N]}function x(N,P){var O;if(typeof N==="undefined"){return D.location.hash.slice(1)}if(typeof N==="number"){O=N;N=B(O);if(N){H=O}else{return}}else{if(typeof N==="string"&&N!==B()){if(H!==-1&&H!==(w.length-1)){w=w.slice(0,H+1)}w.push(N);H=-1}}D.location.hash="#"+N;if(P!==false){J(N)}}function d(){return H===-1?w.length>1:!!H}function z(){return H!==-1&&H<w.length-1}function f(){var O=w.length-1,N=H;if(d()){N=(H===-1?O:H)-1;x(N)}}function o(){if(z()){H=H+1;x(H)}}function r(){function N(){var O=x();if(O&&B()!==O){x(O.replace(/[+ ]/,"_"))}}N();D.setInterval(N,v)}l=(function(){var O={},N=function N(R,Q){var P=!/\W/.test(R)?O[R]=O[R]||N(document.getElementById(R).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+R.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.+?)%>/g,"',$1,'").split("<%").join("');").split("%>").join("p.push('")+"');}return p.join('');");return Q?P(Q):P};return N}());c={slug:function(N,O){c.person(a(N),O)},keyword:function(N,O){m(N,function(P){if(P){c.person(a(P),O)}else{O(false)}})},person:function(N,O){if(N){j(N,function(P){P.type="revolutionary";O(P)});e(N,function(P){q.each(P,function(Q,R){j(R.dbUrl,function(S){S.type="influence";O(S)})})});n(N,function(P){q.each(P,function(Q,R){j(R.dbUrl,function(S){S.type="influenced";O(S)})})})}},init:function(N){if(N){x(N)}r()},cache:i,jsonCache:h,tmpl:l,loadPhoto:u,wikimediaAlternative:F,currentSlug:x,slugHistory:B,prevSlug:f,nextSlug:o,isPrev:d,isNext:z,dbpediaUrl:a,wikipediaUrl:t,urlSlug:G,paragraph:p,sentences:I};return c}());(function(){var n=revolutionaries,g=this,l=g.jQuery,z=g._,e=l(g),k=l("body"),b=l("#sidebar"),u=l("#content"),a=l("#revolutionary"),A=l("#related"),m=l(".search",b),o=l(".history .previous",b),r=l(".history .next",b),w=l(".report",b),d=l(".about",u),h=revolutionaries.tmpl,c,y,j,q;function p(){a.empty();A.empty();c=null;j=null}function x(B,D,s){var C;B=l(B);s=l("."+D+" .photo-container",s||k);C=s.height(),maxH=s.css("max-height");s.css({overflow:"hidden",height:C+"px"}).append(B).animate({height:C+B.outerHeight(true)},"fast",function(){if(parseInt(maxH)){s.height(maxH)}})}function t(B,C,s){n.loadPhoto(s?B.depiction:B.thumbnail,B.name,function(D){if(D){C(this)}else{n.loadPhoto(n.wikimediaAlternative(B.thumbnail),B.name,function(E){if(E){C(this)}})}})}function f(C,B,s){return h("descParaTmpl",{paragraph:n.paragraph(C,B,s)})}function i(){if(n.isPrev()){o.show()}else{o.hide()}if(n.isNext()){r.show()}else{r.hide()}l("#revolutionary .history .previous").replaceWith(o.clone(true));l("#revolutionary .history .next").replaceWith(r.clone(true));m.val(m.attr("title"))}function v(C){var s=C?C.type:false,B,E,D;switch(s){case"revolutionary":if(!s||!C.name){w.text("Sorry. No results...");return false}d.hide();n.currentSlug(n.urlSlug(C.dbUrl),false);D=l(h("descMoreLessTmpl",{moreless:"More >"})).toggle(function(){l(".moreless",E).text("< Less");l(f(C.desc,1)).hide().appendTo(".desc").slideDown("fast")},function(){l(".moreless",E).text("More >");l(".desc p:not(:first)").slideUp("fast",function(){l(this).remove()})});p();w.css("visibility","hidden");a.html(h("itemDetailTmpl",l.extend({},C,{desc:f(C.desc,0,1)})));if(n.sentences(C.desc).length>1){l(".desc p:last",a).append(D)}t(C,function(F){x(F,C.id,a)},true);i();break;case"influence":if(!s){return false}t(C,function(F){if(!c){c=l(h("itemsTmpl",{type:s,title:"Was influenced by..."}));if(j){c.insertBefore(j)}else{c.appendTo(A)}y=c.find("ul")}B=l(h("itemTmpl",{id:C.id,item:h("itemSummaryTmpl",C)}));B.find("a").click(function(){n.person(C.dbUrl,function(G){v(G)});return false});y.append(B);x(F,C.id,A)});break;case"influenced":if(!s){return false}t(C,function(F){if(!j){j=l(h("itemsTmpl",{type:s,title:"Has been an influence to..."})).appendTo(A);q=j.find("ul")}B=l(h("itemTmpl",{id:C.id,item:h("itemSummaryTmpl",C)}));B.find("a").click(function(){n.person(C.dbUrl,function(G){v(G)});return false});q.append(B);x(F,C.id,A)});break}}m.focus(function(){m.val("")}).blur(function(){var s=m.val();m.val(s?s:m.attr("title"))}).parent("form").submit(function(){w.css("visibility","visible").text("Loading...");n.keyword(m.val(),v);return false});l(g).bind("slugchange",function(B,s){w.css("visibility","visible").text("Loading...");n.slug(s,v)});o.click(function(){n.prevSlug()});r.click(function(){n.nextSlug()});if(!n.currentSlug()){d.show()}n.init()}());