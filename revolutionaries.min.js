"use strict";
/*
* The Revolutionaries
*   dharmfly.com/revolutionaries
*   github.com/premasagar/revolutionaries
*
*/
var revolutionaries=(function(){var v=250,w=[],H=-1,D=this,q=D.jQuery,l,c,M;M=D._=(function(){var R=this,Q=R.navigator.userAgent,P=R.console,N=R.opera,O;if(!P){return(N&&N.postError)?function(){var V,T,W=N.postError,U=arguments,S,X,Z;W(U);T=U.length;for(V=0;V<T;V++){S=U[V];if(typeof S==="object"&&S!==null){X=[];for(Z in S){try{if(S.hasOwnProperty(Z)){X.push(Z+": "+S[Z])}}catch(Y){}}W("----subArgs: "+X)}}}:function(){}}else{if(/webkit/i.test(Q)){return function(){var V,T,U=arguments,S="";T=U.length;for(V=0;V<T;V++){if(typeof U[V]==="object"&&JSON&&JSON.stringify){U[V]=JSON.stringify(U[V])}P.log(S+U[V]);S="---- "}}}else{O=P.debug;return O?O:function(){var V,T,W=P.log,U=arguments,S="";if(W){if(typeof W.apply==="function"){W.apply(P,U)}else{T=U.length;for(V=0;V<T;V++){W(S+U[V]);S="---- "}}}}}}}());function i(O,Q){var P="revolutionaries",N,S;try{N=D.localStorage;S=D.JSON;if(!N||!S){return false}O=P+"."+O;if(typeof Q==="undefined"){Q=N[O];return Q?S.parse(Q).v:Q}else{N[O]=S.stringify({v:Q,t:(new Date()).getTime()})}}catch(R){M("localStorage error: ",R);return false}}function h(N,P){var O=i(N);if(O){P(O)}else{q.getJSON(N,function(Q){i(N,Q);P(Q)})}}function A(N){return"http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(N)+"&format=json&callback=?"}function K(P,R,N){var O=A(P),Q=N?h:q.getJSON;Q.call(null,O,function(S){R(S&&S.query&&S.query.results?S.query.results:{})})}function E(N){return"http://dbpedia.org/sparql?query="+encodeURIComponent(N)+"&format=json"}function b(N){return"select results from json where url='"+E(N)+"'"}function L(N){return A('select * from query.multi where queries="'+N.join(";")+'"')}function y(N,P){var O=b(N);K(O,function(Q){P(Q&&Q.json&&Q.json.results&&Q.json.results.bindings?Q.json.results.bindings:Q)},true)}function m(N,P){var O="select url from search.web where query=\"site:en.wikipedia.org/wiki/ '"+N+"'\" LIMIT 1";K(O,function(Q){P(Q?Q.result.url:false)},true)}function a(O){var P="http://dbpedia.org/resource/",N="http://en.wikipedia.org/wiki/";O=q.trim(O);if(O.indexOf(N)===0){return O.replace(N,P)}return P+O}function t(O){var P="http://dbpedia.org/resource/",N="http://en.wikipedia.org/wiki/";O=q.trim(O);if(O.indexOf(P)===0){return O.replace(P,N)}return N+O}function G(N){return q.trim(N).replace(/^.*\/(.*)\/?$/,"$1")}function g(N){return N.toLowerCase().replace(/[_ ]/g,"-").replace(/[^a-z\-]/g,"")}function k(N){return g(G(N))}function F(N){return N.replace("/en/","/commons/")}function C(O,N){return O.replace(/\d+px/,N+"px")}function s(N){return N.replace(/ \([^\)]*\)/,"")}function u(P,O,Q){if(P){var N;N=q('<img class="photo" src="'+P+'" alt="'+(O||"")+'">')[0];N.onload=function(){Q.call(this,true)};N.onerror=function(){Q.call(this,false)}}}function j(O,P){var N=100;return y("PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> PREFIX foaf: <http://xmlns.com/foaf/0.1/> SELECT ?name, ?depiction, ?thumbnail, ?influences, ?abstract WHERE { <"+O+'> rdfs:label ?name; foaf:depiction ?depiction ; <http://dbpedia.org/ontology/thumbnail> ?thumbnail; <http://dbpedia.org/ontology/abstract> ?abstract. FILTER langMatches( lang(?name), "EN" ) . FILTER langMatches( lang(?abstract), "EN" ) . }',function(Q){P({type:"person-detail",id:k(O),url:t(O),dbUrl:O,name:Q.name?s(Q.name.value):"",depiction:Q.depiction?Q.depiction.value:"",thumbnail:Q.thumbnail?C(Q.thumbnail.value,N):"",desc:Q["abstract"]?Q["abstract"].value:""})})}function e(O,P,N){return y("PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> PREFIX foaf: <http://xmlns.com/foaf/0.1/> SELECT ?influenced, ?name WHERE { ?influenced <http://dbpedia.org/property/influenced> <"+O+'> . OPTIONAL { ?influenced foaf:name ?name . } FILTER langMatches( lang(?name), "EN" ) . }',function(Q){var R={};Q=q.map(Q,function(U,T){var S=U.influenced.value;if(!R[S]){R[S]=true;return U}});q.each(Q,function(S,T){Q[S]={type:"person-summary",dbUrl:T.influenced.value,url:t(T.influenced.value),id:k(T.influenced.value),name:T.name?s(T.name.value):"",depiction:T.depiction?T.depiction.value:"",thumbnail:T.thumbnail?T.thumbnail.value:"",desc:T["abstract"]?T["abstract"].value:""}});P(Q)})}function n(N,O){return y("PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> PREFIX foaf: <http://xmlns.com/foaf/0.1/> SELECT DISTINCT ?influence, ?name WHERE { ?influence <http://dbpedia.org/property/influences> <"+N+'> . OPTIONAL { ?influence foaf:name ?name . } FILTER langMatches( lang(?name), "EN" ) . }',function(P){var Q={};P=q.map(P,function(T,S){var R=T.influence.value;if(!Q[R]){Q[R]=true;return T}});q.each(P,function(R,S){P[R]={type:"person-summary",dbUrl:S.influence.value,url:t(S.influence.value),id:k(S.influence.value),name:S.name?s(S.name.value):"",depiction:S.depiction?S.depiction.value:"",thumbnail:S.thumbnail?S.thumbnail.value:"",desc:S["abstract"]?S["abstract"].value:""}});O(P)})}function I(O,R,Q){R=R||0;var S="@@R@E@V@O~L~U~T~I~O@N@A@R@Y@",P=q.trim(O).replace(/(\w\w\w)\.\s+/g,"$1."+S).split(S),N=P.length;P[N-1].replace(/(?!\.)$/,".");Q=typeof Q==="number"?Q:N;return P.slice(R,Q)}function p(N,P,O){if(typeof N==="string"){return p(I(N,P,O))}else{return N.join(" ")}}function J(N){q(D).trigger("slugchange",N)}function B(N){if(q.isArray(N)){return w}if(typeof N!=="number"){N=H}return N===-1?w[w.length-1]:w[N]}function x(N,P){var O;if(typeof N==="undefined"){return D.location.hash.slice(1)}if(typeof N==="number"){O=N;N=B(O);if(N){H=O}else{return}}else{if(typeof N==="string"&&N!==B()){if(H!==-1&&H!==(w.length-1)){w=w.slice(0,H+1)}w.push(N);H=-1}}D.location.hash="#"+N;if(P!==false){J(N)}}function d(){return H===-1?w.length>1:!!H}function z(){return H!==-1&&H<w.length-1}function f(){var O=w.length-1,N=H;if(d()){N=(H===-1?O:H)-1;x(N)}}function o(){if(z()){H=H+1;x(H)}}function r(){function N(){var O=x();if(O&&B()!==O){x(O.replace(/[+ ]/,"_"))}}N();D.setInterval(N,v)}l=(function(){var O={},N=function N(R,Q){var P=!/\W/.test(R)?O[R]=O[R]||N(document.getElementById(R).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+R.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.+?)%>/g,"',$1,'").split("<%").join("');").split("%>").join("p.push('")+"');}return p.join('');");return Q?P(Q):P};return N}());c={slug:function(N,O){c.person(a(N),O)},keyword:function(N,O){m(N,function(P){if(P){c.person(a(P),O)}else{O(false)}})},person:function(N,O){if(N){j(N,function(P){P.type="revolutionary";M(P,O);O(P)});e(N,function(P){q.each(P,function(Q,R){j(R.dbUrl,function(S){S.type="influence";O(S)})})});n(N,function(P){q.each(P,function(Q,R){j(R.dbUrl,function(S){S.type="influenced";O(S)})})})}},init:function(N){if(N){x(N)}r()},cache:i,jsonCache:h,tmpl:l,loadPhoto:u,wikimediaAlternative:F,currentSlug:x,slugHistory:B,prevSlug:f,nextSlug:o,isPrev:d,isNext:z,dbpediaUrl:a,wikipediaUrl:t,urlSlug:G,paragraph:p,sentences:I};return c}());(function(){var o=revolutionaries,h=this,m=h.jQuery,A=h._,f=m(h),l=m("body"),c=m("#sidebar"),v=m("#content"),b=m("#revolutionary"),B=m("#related"),n=m(".search",c),p=m(".history .previous",c),t=m(".history .next",c),x=m(".report",c),e=m(".about",v),i=revolutionaries.tmpl,d,z,k,r;function q(){b.empty();B.empty();d=null;k=null}function y(C,E,s){var D;C=m(C);s=m("."+E+" .photo-container",s||l);D=s.height(),maxH=s.css("max-height");s.css({overflow:"hidden",height:D+"px"}).append(C).animate({height:D+C.outerHeight(true)},"fast",function(){if(parseInt(maxH)){s.height(maxH)}})}function u(C,D,s){o.loadPhoto(s?C.depiction:C.thumbnail,C.name,function(E){if(E){D(this)}else{o.loadPhoto(o.wikimediaAlternative(C.thumbnail),C.name,function(F){if(F){D(this)}})}})}function g(D,C,s){return i("descParaTmpl",{paragraph:o.paragraph(D,C,s)})}function a(s){var E=m(this),D=E.find(".previous"),C=E.find(".next");D.click(function(){o.prevSlug()});C.click(function(){o.nextSlug()})}function j(E){var D=m(".history.nav",v),C=D.find(".previous"),s=D.find(".next");C[o.isPrev()?"show":"hide"]();s[o.isNext()?"show":"hide"]()}function w(D){var s=D?D.type:false,C,F,E;switch(s){case"revolutionary":if(!s||!D.name){x.text("Sorry. No results...");return false}e.hide();o.currentSlug(o.urlSlug(D.dbUrl),false);E=m(i("descMoreLessTmpl",{moreless:"More >"})).toggle(function(){m(".moreless",F).text("< Less");m(g(D.desc,1)).hide().appendTo(".desc").slideDown("fast")},function(){m(".moreless",F).text("More >");m(".desc p:not(:first)").slideUp("fast",function(){m(this).remove()})});q();x.css("visibility","hidden");b.html(i("itemDetailTmpl",m.extend({},D,{desc:g(D.desc,0,1),nav:i("navTmpl",{})})));if(o.sentences(D.desc).length>1){m(".desc p:last",b).append(E)}u(D,function(G){y(G,D.id,b)},true);j(b);n.val(n.attr("title"));break;case"influence":if(!s){return false}u(D,function(G){if(!d){d=m(i("itemsTmpl",{type:s,title:"Was influenced by..."}));if(k){d.insertBefore(k)}else{d.appendTo(B)}z=d.find("ul")}C=m(i("itemTmpl",{id:D.id,item:i("itemSummaryTmpl",D)}));C.find("a").click(function(){o.person(D.dbUrl,function(H){w(H)});return false});z.append(C);y(G,D.id,B)});break;case"influenced":if(!s){return false}u(D,function(G){if(!k){k=m(i("itemsTmpl",{type:s,title:"Has been an influence to..."})).appendTo(B);r=k.find("ul")}C=m(i("itemTmpl",{id:D.id,item:i("itemSummaryTmpl",D)}));C.find("a").click(function(){o.person(D.dbUrl,function(H){w(H)});return false});r.append(C);y(G,D.id,B)});break}}n.focus(function(){n.val("")}).blur(function(){var s=n.val();n.val(s?s:n.attr("title"))}).parent("form").submit(function(){x.css("visibility","visible").text("Loading...");o.keyword(n.val(),w);return false});m(h).bind("slugchange",function(C,s){x.css("visibility","visible").text("Loading...");o.slug(s,w)});if(!o.currentSlug()){e.show()}o.init()}());